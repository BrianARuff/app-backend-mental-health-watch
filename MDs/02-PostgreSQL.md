### **Setting Up database by the CLI**
1. `postgres psql`
2. `CREATE DATABASE test;`
3. `\c test`

---

### **Create table in PSQL**
```
CREATE TABLE test (
    name varchar(30),
    age smallint
  );
```

---

### **Inserting into Database with psql**

```
INSERT INTO test(name, age)
VALUES ('Brian', 30);
```

---

### **Search all results in table with psql**

```
SELECT * FROM test;

```

### [Full Text Search](https://www.compose.com/articles/mastering-postgresql-tools-full-text-search-and-phrase-search/)

#### Note: Perform Magical Search Operations with the Following
1. `to_tsvector` 
    - creates a list of tokens. The `ts` in `to_tsvector` stands for text search.

2. `to_tsquery`
    - quries the token list generated by `to_tsvector` by looking through certain words that have been indexed.

3. If you were to run `to_tsvector` on the text **"The quick brown fox jumped over the lazy dog."**
     - It would return a list with results something like: 

###### **{ **"quick": 2**, **"brown": 3**, **"fox": 4**, **"jumped": 5**, **"lazy": 8**, **"dog": 9** }**
  - **But wait there is more**, it sorts it alphabetically as well like such!!
    - {"brown": 3 "dog": 9 "fox": 4 "jumped": 5 "lazy": 8 "quick": 2}
    - Note that the numbers are the index of the order the word appears in the original sentence.
  - There is even more magic happening though.
      - `to_tsvector`, by default, ***lexeme*** each indexed word, so the result object is now this:
        - {"brown": 3, "dog": 9, "fox": 4, "***jump***": 5, "***lazi***": 8 "quick": 2}.
         - jumped was switched to jump and lazy was switched to lazi. This all happens based on the localization of your postgresql setup.
```
SELECT * FROM test
WHERE to_tsvector(description) @@ to_tsquery('string value to search here');
```

---

### **Alter** Table and **ADD** Column with psql query

```
  ALTER TABLE test
  ADD COLUMN description text NOT NULL;
 ```
The column description will be of type text and will be required because it's not allowed to be a null value.

---

### **Drop** Column from table

```
ALTER TABLE test
DROP COLUMN description;
```

### **Drop Entire Table ðŸ¤•ðŸ¥Š** - Delete the entire table from the database!

```
DROP TABLE test
```

### Truncate table - Truncating clears the table's contents, but not the table itself
```
TRUNCATE TABLE test;
```

### Encrypt password via database using PostgreSQL: [source](https://x-team.com/blog/storing-secure-passwords-with-postgresql/)
```
CREATE EXECUTE pgcrypto
```
When creating a table you can set the column field of your password you can put a data-type of what you want, but I put varchar(255).

When I do table insertions in-order to get this add-on to work properly I would have to do something like the following. The first agrument in the crypt function is the password of the user. The second argument is a function callback called `gen_salt` and takes 1 argument that is specifying that algorithm being used to encrypyt the password with. The encryption algorithm here is `bf` which is short for `blow-fish`. Other algorithms include `md5, xdes, and des`. **The `blow-fish` maximum length is 72 characters, so there is no need to make your varchar type larger than that**.

```
crypt('hard_password', gen_salt('bf'))
```

### Automatically updating Timestamps [source](https://x-team.com/blog/automatic-timestamps-with-postgresql/)

#### Step 1: Create the function
 - Using the PL/pgSQL built-in (by default) to PostgreSQL
 - The returned `new` object is a RECORD object containing data being inserted

```
CREATE OR REPLACE FUNCTION trigger_set_timestamp()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

#### Step 2: Create Table with PostgreSQL

```
CREATE TABLE todos (
  id SERIAL NOT NULL PRIMARY KEY,
  content TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  completed_at TIMESTAMPTZ
);
```

#### Step 3: Create the trigger

```
CREATE TRIGGER set_timestamp
BEFORE UPDATE ON todos
FOR EACH ROW
EXECUTE PROCEDURE trigger_set_timestamp()
```
- This trigger will cause the function `trigger_set_timestamp` from **step 1** to be executed whenever a row is updated in the table.

#### Step 4: Test it out!
```
INSERT INTO todos (content) 
VALUES ('buy milk') RETURNING *;
```
 - This updates the `updated_at` and `completed_at` columns automatically!
